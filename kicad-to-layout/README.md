# Kicad-to-layout

This is a small javascript utility to parse a `.kicad_pcb` file to get a list of
switch locations and orientations, and generate a layout suitable for rendering
with other tools in this repo.

It is based heavily on the snippet [layout.py] by [crides].

I started by using [kicad-utils] but it is several years old and consequently a
number of keyboard PCBs I've tested can't be parsed. Kicad PCBs are composed of
big _s-expression_ trees so it seemed better to have a simple generic parser
that I can query with as much specificity as needed.

## Usage

```
    node bin/kicad-to-layout.js [options] <path>

    Options:
      --invert-x    Flip layout data along X axis

      --mirror-x    Mirror layout along X axis (to produce a full keyboard
                    from a single PCB of a symmetric split).

      --preview     Render the generated layout in terminal using Unicode
                    braille dots.

      --choc        Interpret switch positioning based on kailh choc key
                    spacing (18.5mm x 17.5mm).
```

### Example:

```
$ node ./bin/kicad-to-layout.js --choc --preview osprette.kicad_pcb

‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£∂‚£∂‚£¶‚£Ñ‚°Ä‚¢†‚£∂‚£∂‚£§‚£Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£†‚£¥‚£∂‚°Ñ‚¢Ä‚£†‚£§‚£∂‚£∂‚£¶
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£ø‚£ø‚£ø‚£ø‚°ø‚¢°‚£ø‚£ø‚£ø‚£ø‚£ø‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚£ø‚£ø‚£ø‚£ø‚£ø‚°å‚¢ø‚£ø‚£ø‚£ø‚£ø‚£Ü
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£ç‚°õ‚†ø‚£ø‚°ø‚†Å‚£õ‚†ø‚¢ø‚£ø‚£ø‚†è‚¢†‚£Ñ‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£§‚†ò‚£ø‚£ø‚£ø‚†ø‚†õ‚°à‚¢ø‚°ø‚†ø‚†õ‚£â‚°Ñ
‚†Ä‚¢Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£ø‚£ø‚£ø‚£∑‚£¶‚†Å‚£∞‚£ø‚£ø‚£∂‚£§‚°â‚¢†‚£ø‚£ø‚£ø‚£∑‚£¶‚†Ä‚£Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°Ä‚£§‚£∂‚£ø‚£ø‚£ø‚£á‚†à‚£Å‚£§‚£∂‚£ø‚£∑‚°Ä‚£§‚£∂‚£ø‚£ø‚£ø‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°Ä
‚†Ä‚£æ‚£ø‚£∑‚£¶‚£Ñ‚†Ä‚£∞‚£ø‚£ø‚£∂‚£§‚°Ä‚††‚¢ø‚£ø‚£ø‚£ø‚£ø‚†É‚£∞‚£ø‚£ø‚£ø‚£ø‚°ø‚†°‚¢ø‚£ø‚£ø‚£ø‚£ø‚†É‚£∞‚£ø‚£ø‚£∂‚£§‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£§‚£∂‚£ø‚£∑‚°ò‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ü‚¢π‚£ø‚£ø‚£ø‚£ø‚£∑‚°ò‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ñ‚¢Ä‚£†‚£¥‚£æ‚£ø‚£∑‚†Ä‚£§‚£∂‚£æ‚£ø‚£∑‚°Ä
‚£º‚£ø‚£ø‚£ø‚£ø‚°è‚£∞‚£ø‚£ø‚£ø‚£ø‚°ø‚¢Å‚£∂‚£§‚£à‚†ô‚†ª‚†É‚¢†‚£Ñ‚£â‚†õ‚†ø‚°ø‚¢Å‚£∂‚£§‚£å‚°ô‚†ª‚†É‚£∞‚£ø‚£ø‚£ø‚£ø‚°ø‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†π‚£ø‚£ø‚£ø‚£ø‚£∑‚°ò‚†ø‚¢õ‚£â‚£§‚£∂‚°Ä‚¢ª‚°ø‚†ü‚£ã‚£•‚£∂‚°ò‚†ø‚¢õ‚£â‚£§‚£∂‚°à‚¢ø‚£ø‚£ø‚£ø‚£ø‚£á‚†ò‚£ø‚£ø‚£ø‚£ø‚£∑‚°Ä
‚†Ä‚†â‚†õ‚†ø‚°ü‚¢†‚£ç‚°õ‚†ª‚¢ø‚°ø‚†Å‚£º‚£ø‚£ø‚£ø‚£ø‚°∂‚¢†‚£ø‚£ø‚£ø‚£ø‚°∂‚¢Ä‚£æ‚£ø‚£ø‚£ø‚£ø‚†É‚¢†‚£Ñ‚°â‚†õ‚†ø‚°ø‚†Å‚†Ä‚¢∏‚£ø‚£ø‚£ø‚£ø‚°á‚†Ä‚†Ä‚†π‚£ø‚†ø‚†õ‚£â‚£§‚†ò‚£ø‚£ø‚£ø‚£ø‚£∑‚°Ä‚¢∂‚£ø‚£ø‚£ø‚£ø‚£ß‚†ò‚£ø‚£ø‚£ø‚£ø‚£∑‚°à‚¢ø‚°ø‚†ø‚†õ‚£â‚°Ñ‚†ò‚†ø‚†õ‚†ã‚†Å
‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£ø‚£ø‚£ø‚£∑‚£¶‚†Ä‚†ò‚†ª‚¢ø‚£ø‚£ø‚°ø‚†°‚¢ø‚£ø‚£ø‚£ø‚°ø‚†Å‚£ö‚†ø‚£ø‚£ø‚£ø‚°è‚¢†‚£ø‚£ø‚£ø‚£∑‚£¶‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚£ø‚£ø‚°á‚†Ä‚†Ä‚†Ä‚£§‚£∂‚£ø‚£ø‚£ø‚£á‚†ò‚£ø‚£ø‚£ø‚†ø‚†ì‚°à‚¢ø‚£ø‚£ø‚£ø‚°ø‚†Ü‚†ò‚£ø‚£ø‚£ø‚°ø‚†ó‚†Ä‚£§‚£∂‚£ø‚£ø‚£ø‚°Ñ
‚†Ä‚†Ä‚†Ä‚††‚¢ø‚£ø‚£ø‚£ø‚£ø‚†á‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†ô‚†Å‚†Ä‚†Ä‚†à‚†ô‚†ª‚†Å‚£∞‚£ø‚£ø‚£∂‚£≠‚°õ‚††‚¢ø‚£ø‚£ø‚£ø‚£ø‚†É‚†Ä‚†Ä‚†Ä‚†ò‚†õ‚†õ‚†õ‚†õ‚†É‚†Ä‚†Ä‚†Ä‚†ò‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ü‚†à‚£Å‚£§‚£∂‚£ø‚£∑‚°à‚†õ‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†ò‚†ã‚†Å‚†Ä‚†Ä‚†Ä‚†ò‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ñ
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†ô‚†ª‚†è‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£∞‚£ø‚£ø‚£ø‚£ø‚°ø‚¢°‚£ø‚£∂‚£¨‚£ô‚†ª‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚†ø‚¢õ‚£©‚£¥‚£æ‚°Ñ‚¢π‚£ø‚£ø‚£ø‚£ø‚£∑‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚†ø‚†õ‚†â
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚†õ‚†ø‚°ø‚¢°‚£ø‚£ø‚£ø‚£ø‚£ø‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ñ‚¢ª‚°ø‚†ü‚†ã‚†Å
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°õ‚†ø‚¢ø‚£ø‚£ø‚†è‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ä‚£Ä‚£Ä‚£Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚£ø‚£ø‚£ø‚†ø‚†õ‚°Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£æ‚£ø‚£∑‚£¶‚£Ñ‚°â‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚£ø‚£ø‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚£Å‚£§‚£∂‚£ø‚£∑‚°Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£º‚£ø‚£ø‚£ø‚£ø‚°ø‚¢°‚£ø‚£∂‚£§‚£Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚£ø‚£ø‚°á‚†Ä‚†Ä‚†Ä‚¢Ä‚£†‚£¥‚£æ‚°Ñ‚†π‚£ø‚£ø‚£ø‚£ø‚£∑‚°Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚†õ‚†ø‚°ø‚¢°‚£ø‚£ø‚£ø‚£ø‚£ø‚†É‚†Ä‚†Ä‚†à‚†â‚†â‚†â‚†â‚†Å‚†Ä‚†Ä‚†ò‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ñ‚†π‚£ø‚†ø‚†õ‚†â
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚†õ‚†ø‚£ø‚£ø‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚£ø‚£ø‚°ø‚†ü‚†ã
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†Å
```

üëÜ Ok, so, font rendering of the braille unicode codepoints can differ. "Blank"
spaces may not have consistent widths between different text viewers.

## Disclaimer

I don't work with PCBs so I don't know of all the nuance and conventions people
use when designing keyboards. This script is a good way to get started with some
layout data, but expect to manually tweak the results afterwards.

## Known issues

- Rotation is complicated in a number of ways
- Key sizing is not currently takend into consideration
- Switch modules are often defined in arbitrary order which means this may not
  produce a layout that you can just use with `keymap-editor` or `keymap-drawer`
- Much more, this is a very basic implementation right now.


[crides]:https://github.com/crides
[layout.py]:https://gist.github.com/crides/6d12d1033368e24873b0142941311e5d
[kicad-utils]:https://www.npmjs.com/package/kicad-utils